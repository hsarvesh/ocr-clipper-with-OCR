<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="OCR Image Clipper â€” Crop image regions and extract text with cloud OCR">
    <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin-allow-popups">
    <title>OCR Image Clipper</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <!-- Cropper.js -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.2/cropper.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.2/cropper.min.js"></script>

    <!-- SortableJS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.3/Sortable.min.js"></script>

    <!-- App Styles -->
    <link rel="stylesheet" href="src/css/styles.css">

    <!-- Auth & Credits (must load before main) -->
    <script src="src/js/auth.js"></script>
    <script src="src/js/credits.js"></script>
</head>

<body>
    <!-- ===================== AUTH SCREEN ===================== -->
    <div id="auth-container" class="auth-container">
        <div class="auth-box">
            <div class="auth-logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="48" height="48">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                    <circle cx="8.5" cy="8.5" r="1.5" />
                    <polyline points="21 15 16 10 5 21" />
                </svg>
            </div>
            <h1>OCR Image Clipper</h1>
            <p class="auth-description">
                Crop image regions and extract text with our cloud-powered OCR engine.
                Sign in to get started.
            </p>
            <button class="google-sign-in" onclick="signInWithGoogle()">
                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 48 48'%3E%3Cpath fill='%23FFC107' d='M43.6 20H24v8.3h11.3c-1.1 5.4-5.7 8.3-11.3 8.3-6.9 0-12.5-5.6-12.5-12.5S17.1 11.6 24 11.6c3.1 0 5.9 1.2 8 3.1l6.3-6.3C34.2 4.6 29.3 2.6 24 2.6 11.8 2.6 2 12.4 2 24.6s9.8 22 22 22c11 0 21-8 21-22 0-1.3-.2-2.7-.4-4.6z'/%3E%3C/svg%3E"
                    alt="Google logo">
                Sign in with Google
            </button>
            <p class="auth-footer">By signing in, you agree to our Terms of Service and Privacy Policy</p>
        </div>
    </div>

    <!-- ===================== MAIN APP ===================== -->
    <div id="main-content" class="hidden">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1 class="page-title">OCR Image Clipper</h1>
            </div>
            <div class="header-right">
                <div class="user-profile">
                    <button id="user-name" class="profile-button" onclick="toggleProfileMenu(event)">
                        <img id="user-photo" class="user-photo" src="" alt="Profile photo">
                        <span id="user-display-name"></span>
                        <span class="material-icons">arrow_drop_down</span>
                    </button>
                    <div id="profile-menu" class="profile-menu">
                        <div class="profile-header">
                            <div class="profile-name" id="profile-full-name"></div>
                            <div class="profile-email" id="profile-email"></div>
                        </div>
                        <div class="credits-section">
                            <div class="credits-info">
                                <span class="credits-icon">ðŸ’Ž</span>
                                <span class="credits-amount-lg" id="menu-credits-amount">-</span>
                                <span class="credits-label">Credits Available</span>
                            </div>
                        </div>
                        <div class="profile-divider"></div>
                        <div class="profile-info">
                            <div class="menu-item" id="last-login">
                                <span class="material-icons">access_time</span>
                                <span></span>
                            </div>
                        </div>
                        <div class="profile-divider"></div>
                        <div class="menu-item sign-out" onclick="signOut()">
                            <span class="material-icons">logout</span>
                            Sign Out
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Stepper -->
        <div class="stepper" id="stepper">
            <div class="step active" data-step="1">
                <div class="step-number">1</div>
                <div class="step-title">Upload Images</div>
            </div>
            <div class="step" data-step="2">
                <div class="step-number">2</div>
                <div class="step-title">Clip & Queue</div>
            </div>
            <div class="step" data-step="3">
                <div class="step-number">3</div>
                <div class="step-title">Processing</div>
            </div>
            <div class="step" data-step="4">
                <div class="step-number">4</div>
                <div class="step-title">Results</div>
            </div>
        </div>

        <!-- Main Content Area -->
        <main class="main-content">

            <!-- ========== STEP 1: UPLOAD IMAGES ========== -->
            <section class="screen" id="screen1" data-screen="1">
                <div class="card">
                    <h2 class="card-title">Upload Images</h2>
                    <p class="card-subtitle">Select one or more images to process with OCR</p>
                    <div class="upload-zone" id="dropZone">
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-icon-wrapper">
                                <span class="material-icons upload-icon-main">cloud_upload</span>
                            </div>
                            <label for="imageInput" class="btn btn-primary upload-btn">
                                <span class="material-icons">add_photo_alternate</span>
                                Choose Images
                            </label>
                            <input type="file" id="imageInput" multiple accept="image/*"
                                aria-label="Select images for processing">
                            <p class="upload-hint">or drag and drop images here</p>
                        </div>
                    </div>
                    <div class="file-list" id="fileList"></div>
                    <div class="nav-buttons">
                        <button class="btn btn-primary" id="step1Next" disabled>
                            Next <span class="material-icons">arrow_forward</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- ========== STEP 2: CLIP & QUEUE ========== -->
            <section class="screen hidden" id="screen2" data-screen="2">
                <div class="clip-header">
                    <h2 class="card-title">Clip & Queue</h2>
                    <div class="process-mode-toggle">
                        <span class="toggle-label">Batch Process</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="immediateToggle">
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-label">Process Immediately</span>
                    </div>
                </div>
                <div class="clip-workspace">
                    <!-- Left Panel: Image List -->
                    <div class="clip-sidebar">
                        <h3 class="panel-title">
                            <span class="material-icons">collections</span> Source Images
                        </h3>
                        <div class="image-list" id="imageList"></div>
                    </div>
                    <!-- Right Panel: Cropper -->
                    <div class="clip-main">
                        <div class="cropper-controls hidden" id="cropperControls">
                            <button class="btn btn-accent" id="addToQueue">
                                <span class="material-icons">add_to_photos</span>
                                Add to OCR Queue
                            </button>
                            <div class="controls-spacer"></div>
                            <button class="btn btn-icon" id="zoomIn" title="Zoom In">
                                <span class="material-icons">zoom_in</span>
                            </button>
                            <button class="btn btn-icon" id="zoomOut" title="Zoom Out">
                                <span class="material-icons">zoom_out</span>
                            </button>
                            <button class="btn btn-icon" id="rotateLeft" title="Rotate Left">
                                <span class="material-icons">rotate_left</span>
                            </button>
                            <button class="btn btn-icon" id="rotateRight" title="Rotate Right">
                                <span class="material-icons">rotate_right</span>
                            </button>
                            <button class="btn btn-icon" id="resetCrop" title="Reset">
                                <span class="material-icons">restart_alt</span>
                            </button>
                        </div>
                        <div class="cropper-container" id="cropperContainer">
                            <div class="cropper-placeholder" id="cropperPlaceholder">
                                <span class="material-icons">crop</span>
                                <p>Select an image from the left panel to start clipping</p>
                            </div>
                            <img id="cropperImage" style="display:none;" alt="Image to crop">
                        </div>
                    </div>
                </div>

                <!-- OCR Queue Strip -->
                <div class="queue-section">
                    <div class="queue-header">
                        <h3 class="panel-title">
                            <span class="material-icons">view_list</span>
                            OCR Queue
                            <span class="queue-count" id="queueCount">0</span>
                        </h3>
                        <div class="queue-actions">
                            <button class="btn btn-sm btn-danger" id="clearQueue" disabled>
                                <span class="material-icons">delete_sweep</span> Clear All
                            </button>
                        </div>
                    </div>
                    <div class="queue-strip" id="queueStrip">
                        <div class="queue-empty" id="queueEmpty">
                            <span class="material-icons">inbox</span>
                            <p>No clips in queue yet. Select a region and click "Add to OCR Queue".</p>
                        </div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" id="step2Back">
                        <span class="material-icons">arrow_back</span> Back
                    </button>
                    <button class="btn btn-primary" id="step2Next" disabled>
                        <span class="material-icons">play_arrow</span> Process All
                    </button>
                </div>
            </section>

            <!-- ========== STEP 3: PROCESSING ========== -->
            <section class="screen hidden" id="screen3" data-screen="3">
                <div class="card processing-card">
                    <h2 class="card-title">Processing Images</h2>
                    <p class="card-subtitle" id="processingSubtitle">Sending clips to OCR engine...</p>
                    <div class="progress-section">
                        <div class="progress-bar-track">
                            <div class="progress-bar" id="progressBar" role="progressbar" aria-valuemin="0"
                                aria-valuemax="100" aria-valuenow="0">
                                <span class="progress-text">0%</span>
                            </div>
                        </div>
                        <p class="progress-status" id="progressCount">Processing 0 of 0 clips</p>
                        <p class="progress-current" id="currentFile">Preparing...</p>
                    </div>
                    <div class="progress-list" id="progressList"></div>
                </div>
            </section>

            <!-- ========== STEP 4: RESULTS ========== -->
            <section class="screen hidden" id="screen4" data-screen="4">
                <div class="results-header">
                    <h2 class="card-title">Results</h2>
                    <div class="results-actions">
                        <button class="btn btn-secondary" id="downloadAll">
                            <span class="material-icons">download</span> Download All
                        </button>
                        <button class="btn btn-primary" id="processMore">
                            <span class="material-icons">refresh</span> Process More
                        </button>
                    </div>
                </div>
                <p class="results-hint">
                    <span class="material-icons">drag_indicator</span>
                    Drag result cards to reorder. Download order follows the card sequence.
                </p>
                <div class="results-list" id="resultsList"></div>
                <div class="nav-buttons">
                    <button class="btn btn-secondary" id="step4Back">
                        <span class="material-icons">arrow_back</span> Back to Clip
                    </button>
                    <button class="btn btn-secondary" id="downloadAllBottom">
                        <span class="material-icons">download</span> Download All Text
                    </button>
                    <button class="btn btn-primary" id="processMoreBottom">
                        <span class="material-icons">refresh</span> Process More Images
                    </button>
                </div>
            </section>

        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <div class="version-info">
                <span class="app-version">v2.6.43</span>
                <span class="version-date">Updated: 2026-02-23</span>
            </div>
        </footer>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast" role="alert" aria-live="polite">Action completed</div>

    <!-- App Scripts -->
    <script src="src/js/toast.js"></script>
    <script src="src/js/stepper.js"></script>
    <script src="src/js/image-loader.js"></script>
    <script src="src/js/image-clipper.js"></script>
    <script src="src/js/preview-queue.js"></script>
    <script src="src/js/ocr-service.js"></script>
    <script src="src/js/results-viewer.js"></script>
    <script src="src/js/download-manager.js"></script>
    <script src="src/js/app.js"></script>
</body>

</html>